extends ../layout

block content
  .container
    .row.justify-content-center
      .col-12.col-md-10
        .card.shadow-sm
          .card-body
            // Title row: Job Order + Orders explorer button
            .d-flex.justify-content-between.align-items-center.mb-3
              h4.mb-0 Job Order
              // Orders explorer trigger
              button.btn.btn-outline-secondary.btn-sm#openOrdersExplorerBtn(type='button', title='View orders')
                i.bi.bi-list-check.me-1
                | Orders

            // selection row
            .row.g-2.mb-3
              .col-md-7
                label.form-label(for='serviceSelect') Service
                select.form-select(id='serviceSelect')
                  option(value='') -- Select a service --
                  each s in services
                    option(value=s._id)= s.name
              .col-md-5.d-flex.align-items-end
                small.text-muted.ms-auto Select a service to load price rules

            // price rules list (populated via AJAX)
            .card.mt-3
              .card-body
                h6.mb-2 Price rules for selected service
                p.text-muted.small Select a rule and enter number of pages/qty (if applicable) then click Apply to add to cart.
                #pricesList
                  p.text-muted Select a service to load price rules.

            // Cart / Order summary
            .card.mt-3
              .card-body
                h6.mb-2 Cart
                table.table.table-sm.table-borderless#cartTable
                  thead
                    tr
                      th Selection
                      th.text-center QTY
                      th.text-end Unit
                      th.text-end Subtotal
                      th.text-center Actions
                  tbody#cartTbody
                    tr
                      td.text-muted(colspan='5') Cart is empty.
                .d-flex.justify-content-end.mt-2
                  span.me-3.fs-5 Total:
                  strong.fs-5#cartTotal GHâ‚µ 0.00

                .d-flex.justify-content-end.mt-3
                  button.btn.btn-primary#orderNowBtn(type='button', disabled) Order Now

    // small debug area
    .mt-3.text-muted.small
      | After placing the order you will receive an Order ID to use at payment.

  // Orders Explorer Modal (rich UI, date filters, table)
  .modal.fade(id='ordersExplorerModal', tabindex='-1', aria-labelledby='ordersExplorerModalLabel', aria-hidden='true')
    .modal-dialog.modal-xl.modal-dialog-centered
      .modal-content
        .modal-header
          h5.modal-title(id='ordersExplorerModalLabel') Orders Explorer
          button.btn-close(type='button', data-bs-dismiss='modal', aria-label='Close')
        .modal-body
          .row.g-2.mb-3.align-items-center
            .col-auto
              label.form-label.mb-0 Small Date Range
            .col-auto
              input.form-control(type='date', id='ordersFrom')
            .col-auto
              input.form-control(type='date', id='ordersTo')
            .col
              .btn-group
                button.btn.btn-outline-secondary.btn-sm#presetToday(type='button') Today
                button.btn.btn-outline-secondary.btn-sm#presetYesterday(type='button') Yesterday
                button.btn.btn-outline-secondary.btn-sm#presetThisWeek(type='button') This Week
              button.btn.btn-primary.btn-sm.ms-2#fetchOrdersBtn(type='button') Refresh
            .col-auto.text-end
              small.text-muted#ordersCount -- results

          // search / table
          .table-responsive
            table.table.table-hover.table-sm#ordersTable
              thead
                tr
                  th Order ID
                  th.text-end Total
                  th Status
                  th Created
                  th.text-center Actions
              tbody
                tr
                  td.text-muted(colspan='5') Use the date filters above and click Refresh to load orders.

        .modal-footer
          button.btn.btn-secondary(type='button', data-bs-dismiss='modal') Close

  // Order Details Modal (re-uses copy/print behaviours)
  .modal.fade(id='orderDetailsModal', tabindex='-1', aria-labelledby='orderDetailsModalLabel', aria-hidden='true')
    .modal-dialog.modal-dialog-centered
      .modal-content
        .modal-header
          h5.modal-title(id='orderDetailsModalLabel') Order Details
          button.btn-close(type='button', data-bs-dismiss='modal', aria-label='Close')
        .modal-body
          // details loaded via JS
          .mb-2
            p.small.text-muted#orderDetailsMeta Loading...
          .small#orderDetailsJson(style='white-space:normal;') 
        .modal-footer
          button.btn.btn-outline-secondary(type='button', id='copyDetailOrderIdBtn') Copy Order ID
          button.btn.btn-outline-primary(type='button', id='printDetailOrderBtn') Print
          button.btn.btn-secondary(type='button', data-bs-dismiss='modal') Close

block append scripts
  script(src='/public/javascripts/orders_client.js')
